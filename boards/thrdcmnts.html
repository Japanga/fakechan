<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Comments Section</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; }
        .comment-container { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        textarea { width: 100%; height: 60px; margin-bottom: 10px; }
        button { padding: 5px 10px; }
        .comment { padding: 5px 0; border-bottom: 1px solid #eee; }
        #publicIdDisplay { font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="publicIdDisplay"></div>

    <h2>Posts:</h2>
    <div id="commentsSection">
        <!-- Comments will be dynamically inserted here -->
    </div>

    <h3>Add a reply</h3>
    <textarea id="newCommentText" placeholder="Write your comment here..."></textarea>
    <button onclick="addComment()">Post Comment</button>

    <script>
        const commentsSection = document.getElementById('commentsSection');
        const newCommentText = document.getElementById('newCommentText');
        const publicIdDisplay = document.getElementById('publicIdDisplay');
        let currentPublicId = '';

        // 1. Get the current public_id from the URL
        function getPublicId() {
            const params = new URLSearchParams(window.location.search);
            // Default to 'general' if no ID is provided in the URL
            currentPublicId = params.get('id') || 'general';
            publicIdDisplay.textContent = 'Viewing all replies in thread No: ' + currentPublicId;
        }

        // 2. Load comments for the current public_id from localStorage
        function loadComments() {
            const storedComments = localStorage.getItem('comments_' + currentPublicId);
            return storedComments ? JSON.parse(storedComments) : [];
        }

        // 3. Save comments to localStorage
        function saveComments(comments) {
            localStorage.setItem('comments_' + currentPublicId, JSON.stringify(comments));
        }

        // 4. Display comments in the HTML
        function displayComments() {
            const comments = loadComments();
            commentsSection.innerHTML = '';
            comments.forEach(commentText => {
                const commentDiv = document.createElement('div');
                commentDiv.classList.add('comment');
                commentDiv.textContent = commentText;
                // Add new comments at the top
                commentsSection.insertBefore(commentDiv, commentsSection.firstChild); 
            });
        }

        // 5. Add a new comment
        function addComment() {
            const commentText = newCommentText.value.trim();
            if (commentText === '') return;

            const comments = loadComments();
            comments.push(commentText); // Add the new comment
            saveComments(comments); // Save the updated list
            displayComments(); // Refresh the display

            newCommentText.value = ''; // Clear the input field
        }

        // Initialize the page on load
        getPublicId();
        displayComments();

    </script>
</body>
</html>
