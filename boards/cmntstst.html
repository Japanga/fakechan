<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comments Box</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Replies in thread no. <span id="page-id-display"></span></h1>
    
    <div class="comment-section">
        <h2>Comments</h2>
        <div id="comments-container">
            <!-- Comments will be dynamically loaded here -->
        </div>
        
        <form id="comment-form">
            <textarea id="comment-input" placeholder="Add a comment..." required></textarea><br>
            <button type="submit">Post Comment</button>
        </form>
    </div>

      <style>
        body {
    font-family: sans-serif;
    margin: 20px;
}

.comment-section {
    max-width: 600px;
    margin-top: 20px;
}

#comments-container {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 15px;
}

.comment {
    border-bottom: 1px solid #eee;
    padding: 10px 0;
}

.comment-date {
    font-size: 0.8em;
    color: #888;
    margin-bottom: 5px;
}

#comment-input {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    margin-bottom: 10px;
}

button {
    padding: 10px 15px;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
}
  </style>
  
    <script>
      // Function to get a URL parameter by name
function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

// Get the URL ID (e.g., from ?id=1)
const pageId = getParameterByName('id') || 'general'; // Default to 'general' if no ID
document.getElementById('page-id-display').textContent = pageId;

const commentsContainer = document.getElementById('comments-container');
const commentForm = document.getElementById('comment-form');
const commentInput = document.getElementById('comment-input');

// Key for localStorage specific to this page
const STORAGE_KEY = `comments_${pageId}`;

// 1. Load comments from localStorage
function loadComments() {
    const comments = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    commentsContainer.innerHTML = '';
    
    // Display comments (latest first)
    comments.reverse().forEach(comment => {
        const commentDiv = document.createElement('div');
        commentDiv.classList.add('comment');

        const dateSpan = document.createElement('div');
        dateSpan.classList.add('comment-date');
        dateSpan.textContent = new Date(comment.date).toLocaleString();

        const contentPara = document.createElement('p');
        contentPara.textContent = comment.content;

        commentDiv.appendChild(dateSpan);
        commentDiv.appendChild(contentPara);
        commentsContainer.appendChild(commentDiv);
    });
}

// 2. Add a new comment
function addComment(event) {
    event.preventDefault();
    const content = commentInput.value.trim();

    if (content) {
        const comments = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        const newComment = {
            content: content,
            date: new Date().toISOString() // Store date in standard format
        };

        comments.push(newComment);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(comments));
        commentInput.value = '';
        loadComments(); // Reload comments to update the display
    }
}

// 3. Event listeners
commentForm.addEventListener('submit', addComment);
window.addEventListener('load', loadComments);
  </script>
</body>
</html>
